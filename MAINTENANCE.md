# MCP Feedback Enhanced é¡¹ç›®ç»´æŠ¤æ–‡æ¡£

> ğŸ“… **æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
> ğŸ“… **æœ€åæ›´æ–°**: 2025å¹´12æœˆ30æ—¥  
> ğŸ‘¤ **ç»´æŠ¤è€…**: é¡¹ç›®ç»´æŠ¤å›¢é˜Ÿ  
> ğŸ”– **é¡¹ç›®ç‰ˆæœ¬**: v2.6.0

---

## ğŸ“‘ ç›®å½•

- [1. é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
- [2. æŠ€æœ¯æ ˆä¸æ¶æ„](#2-æŠ€æœ¯æ ˆä¸æ¶æ„)
- [3. å¼€å‘ç¯å¢ƒé…ç½®](#3-å¼€å‘ç¯å¢ƒé…ç½®)
- [4. é¡¹ç›®ç»“æ„è¯¦è§£](#4-é¡¹ç›®ç»“æ„è¯¦è§£)
- [5. æ ¸å¿ƒæ¨¡å—ç»´æŠ¤æŒ‡å—](#5-æ ¸å¿ƒæ¨¡å—ç»´æŠ¤æŒ‡å—)
- [6. æ„å»ºä¸å‘å¸ƒæµç¨‹](#6-æ„å»ºä¸å‘å¸ƒæµç¨‹)
- [7. æµ‹è¯•ç­–ç•¥](#7-æµ‹è¯•ç­–ç•¥)
- [8. å›½é™…åŒ–ç»´æŠ¤](#8-å›½é™…åŒ–ç»´æŠ¤)
- [9. å¸¸è§é—®é¢˜æ’æŸ¥](#9-å¸¸è§é—®é¢˜æ’æŸ¥)
- [10. ä¾èµ–ç®¡ç†](#10-ä¾èµ–ç®¡ç†)
- [11. æ€§èƒ½ä¼˜åŒ–å»ºè®®](#11-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
- [12. å®‰å…¨æ³¨æ„äº‹é¡¹](#12-å®‰å…¨æ³¨æ„äº‹é¡¹)
- [13. è´¡çŒ®æŒ‡å—](#13-è´¡çŒ®æŒ‡å—)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç®€ä»‹

**MCP Feedback Enhanced** æ˜¯ä¸€ä¸ªå¢å¼ºçš„ MCP (Model Context Protocol) æœåŠ¡å™¨ï¼Œç”¨äºåœ¨ AI è¾…åŠ©å¼€å‘è¿‡ç¨‹ä¸­å®ç°äº¤äº’å¼ç”¨æˆ·åé¦ˆå’Œå‘½ä»¤æ‰§è¡Œã€‚

### 1.2 æ ¸å¿ƒç‰¹æ€§

- âœ… **è¶…æ—¶è®¾ç½®ä¿®å¤**: é»˜è®¤æ”¯æŒ 24 å°æ—¶è¶…æ—¶ï¼ˆæœ€é•¿ä¸€å‘¨ï¼‰
- ğŸ–¼ï¸ **å›¾ç‰‡ä¸Šä¼ æ”¯æŒ**: ä¿®å¤åºåˆ—åŒ–é”™è¯¯ï¼Œæ”¯æŒå¤šç§å›¾ç‰‡æ ¼å¼
- ğŸ”— **æ–­ç½‘é‡è¿**: ç¦»çº¿åœºæ™¯ä¸‹ä¿æŒä¼šè¯è¿æ¥
- ğŸŒ **Web UI + æ¡Œé¢åº”ç”¨**: åŒç•Œé¢æ”¯æŒ
- ğŸŒ **å¤šè¯­è¨€**: ç®€ä½“ä¸­æ–‡ã€ç¹ä½“ä¸­æ–‡ã€è‹±æ–‡
- ğŸ”Š **éŸ³æ•ˆé€šçŸ¥**: æ™ºèƒ½éŸ³æ•ˆæé†’ç³»ç»Ÿ
- ğŸ“‹ **ä¼šè¯ç®¡ç†**: å†å²è·Ÿè¸ªä¸ç»Ÿè®¡åˆ†æ
- ğŸ’¡ **æç¤ºè¯ç®¡ç†**: CRUD æ“ä½œä¸å¿«é€Ÿé€‰æ‹©

### 1.3 æœ¬åœ°å®šåˆ¶ç‰ˆæ”¹è¿›

- ä¿®å¤è¶…æ—¶æ°¸è¿œ 600s çš„é—®é¢˜ â†’ é»˜è®¤ 24 å°æ—¶ï¼ˆå¯é…ç½®è‡³ä¸€å‘¨ï¼‰
- ä¿®å¤å›¾ç‰‡ä¸Šä¼ åºåˆ—åŒ–é”™è¯¯
- æ–°å¢æ–­ç½‘ä¸æ–­è¿æ¥åŠŸèƒ½ï¼ˆé€‚åˆçƒ­ç‚¹åœºæ™¯ï¼‰

---

## 2. æŠ€æœ¯æ ˆä¸æ¶æ„

### 2.1 æŠ€æœ¯æ ˆ

#### åç«¯
- **Python**: 3.11+ï¼ˆè¦æ±‚ >= 3.11ï¼‰
- **FastMCP**: 2.0.0+ - MCP åè®®å®ç°
- **FastAPI**: 0.115.0+ - Web æ¡†æ¶
- **Uvicorn**: 0.30.0+ - ASGI æœåŠ¡å™¨
- **Jinja2**: 3.1.0+ - æ¨¡æ¿å¼•æ“
- **WebSockets**: 13.0.0+ - å®æ—¶é€šä¿¡
- **psutil**: 7.0.0+ - ç³»ç»Ÿç›‘æ§

#### æ¡Œé¢åº”ç”¨
- **Tauri**: Rust + ç³»ç»ŸåŸç”Ÿ WebView
- **Python åµŒå…¥**: æ¡Œé¢åº”ç”¨å†…åµŒ Python ç¯å¢ƒ

#### å‰ç«¯
- **HTML5 + CSS3**: åŸç”Ÿ Web æŠ€æœ¯
- **JavaScript ES6+**: æ— æ¡†æ¶ä¾èµ–
- **WebSocket API**: åŒå‘é€šä¿¡
- **Web Audio API**: éŸ³æ•ˆç³»ç»Ÿï¼ˆv2.4.3+ï¼‰

### 2.2 æ¶æ„æ¨¡å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         AI Assistant (Claude)           â”‚
â”‚      (é€šè¿‡ MCP è°ƒç”¨ interactive_feedback) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ MCP Protocol
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      MCP Server (server.py)             â”‚
â”‚   â”œâ”€ ç¯å¢ƒæ£€æµ‹ (SSH/WSL/Local)           â”‚
â”‚   â”œâ”€ ä¼šè¯ç®¡ç† (å•ä¸€æ´»è·ƒä¼šè¯)            â”‚
â”‚   â”œâ”€ èµ„æºç®¡ç† (ä¸´æ—¶æ–‡ä»¶/å†…å­˜ç›‘æ§)       â”‚
â”‚   â””â”€ WebSocket æœåŠ¡å™¨                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ WebSocket + HTTP
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Web UI (templates/index.html)     â”‚
â”‚   â”œâ”€ å®æ—¶åé¦ˆè¡¨å•                        â”‚
â”‚   â”œâ”€ å›¾ç‰‡ä¸Šä¼ ä¸é¢„è§ˆ                      â”‚
â”‚   â”œâ”€ æç¤ºè¯ç®¡ç†                          â”‚
â”‚   â”œâ”€ ä¼šè¯å†å²ä¸ç»Ÿè®¡                      â”‚
â”‚   â””â”€ éŸ³æ•ˆé€šçŸ¥ç³»ç»Ÿ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 å•ä¸€æ´»è·ƒä¼šè¯æ¶æ„

é‡‡ç”¨ **æ›¿ä»£ä¼ ç»Ÿå¤šä¼šè¯ç®¡ç†** çš„è®¾è®¡ï¼š

- **æŒä¹…åŒ– Web UI**: æ— éœ€æ¯æ¬¡é‡æ–°æ‰“å¼€æµè§ˆå™¨
- **ä¼šè¯å¤ç”¨**: åŒä¸€ä¸ªä¼šè¯ ID å¯å¤šæ¬¡è°ƒç”¨
- **è‡ªåŠ¨æ¸…ç†**: è¶…æ—¶æˆ–æ‰‹åŠ¨ç»ˆæ­¢åé‡Šæ”¾èµ„æº
- **çŠ¶æ€åŒæ­¥**: WebSocket å®æ—¶ä¼ é€’çŠ¶æ€å˜åŒ–

---

## 3. å¼€å‘ç¯å¢ƒé…ç½®

### 3.1 å‰ç½®è¦æ±‚

```bash
# Python ç‰ˆæœ¬
Python >= 3.11

# æ¨èä½¿ç”¨ uv åŒ…ç®¡ç†å™¨
pip install uv

# æˆ–ä½¿ç”¨ä¼ ç»Ÿ pip + venv
python -m venv .venv
```

### 3.2 å¿«é€Ÿå¯åŠ¨

#### å¼€å‘æ¨¡å¼

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <your-fork-url>
cd fix-MCP-Feedback-Enhanced

# 2. å®‰è£…ä¾èµ–
uv pip install -e ".[dev]"

# 3. è¿è¡Œå¼€å‘æœåŠ¡å™¨
python -m mcp_feedback_enhanced

# 4. æˆ–ä½¿ç”¨ uv run
uv run python -m mcp_feedback_enhanced
```

#### Cursor/Cline é›†æˆé…ç½®

åœ¨ `mcp_config.json` ä¸­æ·»åŠ ï¼š

```json
{
  "mcpServers": {
    "mcp-feedback-enhanced-local": {
      "command": "uv",
      "args": [
        "run",
        "--directory",
        "D:\\code\\mcp\\fix-MCP-Feedback-Enhanced",
        "python",
        "-m",
        "mcp_feedback_enhanced"
      ],
      "timeout": 604800,
      "env": {
        "MCP_DEBUG": "false",
        "MCP_WEB_HOST": "127.0.0.1",
        "MCP_WEB_PORT": "8765",
        "MCP_DESKTOP_MODE": "false",
        "MCP_LANGUAGE": "zh-CN"
      },
      "autoApprove": ["interactive_feedback"]
    }
  }
}
```

### 3.3 ç¯å¢ƒå˜é‡é…ç½®

| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `MCP_DEBUG` | `false` | è°ƒè¯•æ¨¡å¼å¼€å…³ |
| `MCP_WEB_HOST` | `127.0.0.1` | Web æœåŠ¡å™¨åœ°å€ |
| `MCP_WEB_PORT` | `8765` | Web æœåŠ¡å™¨ç«¯å£ |
| `MCP_DESKTOP_MODE` | `false` | æ¡Œé¢åº”ç”¨æ¨¡å¼ |
| `MCP_LANGUAGE` | `zh-CN` | ç•Œé¢è¯­è¨€ï¼ˆzh-CN/zh-TW/enï¼‰ |

---

## 4. é¡¹ç›®ç»“æ„è¯¦è§£

```
fix-MCP-Feedback-Enhanced/
â”œâ”€â”€ src/mcp_feedback_enhanced/          # æ ¸å¿ƒæºç 
â”‚   â”œâ”€â”€ __init__.py                     # åŒ…åˆå§‹åŒ–
â”‚   â”œâ”€â”€ __main__.py                     # ä¸»å…¥å£
â”‚   â”œâ”€â”€ server.py                       # MCP æœåŠ¡å™¨æ ¸å¿ƒ
â”‚   â”œâ”€â”€ i18n.py                         # å›½é™…åŒ–ç³»ç»Ÿ
â”‚   â”œâ”€â”€ debug.py                        # è°ƒè¯•å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ web/                            # Web åº”ç”¨æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ main.py                     # FastAPI åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ routes/                     # è·¯ç”±å¤„ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ main_routes.py          # ä¸»è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ models/                     # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ feedback_result.py      # åé¦ˆç»“æœ
â”‚   â”‚   â”‚   â””â”€â”€ feedback_session.py     # ä¼šè¯æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ templates/                  # Jinja2 æ¨¡æ¿
â”‚   â”‚   â”‚   â””â”€â”€ index.html              # Web UI ä¸»é¡µ
â”‚   â”‚   â”œâ”€â”€ static/                     # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ locales/                    # å¤šè¯­è¨€æ–‡ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ en/messages.json
â”‚   â”‚   â”‚   â”œâ”€â”€ zh-CN/messages.json
â”‚   â”‚   â”‚   â””â”€â”€ zh-TW/messages.json
â”‚   â”‚   â””â”€â”€ constants/                  # å¸¸é‡å®šä¹‰
â”‚   â”‚       â””â”€â”€ message_codes.py        # æ¶ˆæ¯ä»£ç 
â”‚   â”‚
â”‚   â”œâ”€â”€ desktop_app/                    # æ¡Œé¢åº”ç”¨æ¨¡å—
â”‚   â”‚   â””â”€â”€ desktop_app.py
â”‚   â”‚
â”‚   â””â”€â”€ utils/                          # å·¥å…·æ¨¡å—
â”‚       â”œâ”€â”€ error_handler.py            # é”™è¯¯å¤„ç†æ¡†æ¶
â”‚       â”œâ”€â”€ memory_monitor.py           # å†…å­˜ç›‘æ§
â”‚       â””â”€â”€ resource_manager.py         # èµ„æºç®¡ç†
â”‚
â”œâ”€â”€ src-tauri/                          # Tauri æ¡Œé¢åº”ç”¨
â”‚   â”œâ”€â”€ src/                            # Rust æºç 
â”‚   â”‚   â”œâ”€â”€ main.rs
â”‚   â”‚   â””â”€â”€ lib.rs
â”‚   â”œâ”€â”€ python/                         # æ¡Œé¢ Python åµŒå…¥
â”‚   â”œâ”€â”€ tauri.conf.json                 # Tauri é…ç½®
â”‚   â””â”€â”€ Cargo.toml                      # Rust ä¾èµ–
â”‚
â”œâ”€â”€ tests/                              # æµ‹è¯•å¥—ä»¶
â”‚   â”œâ”€â”€ unit/                           # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ integration/                    # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ helpers/                        # æµ‹è¯•è¾…åŠ©
â”‚
â”œâ”€â”€ scripts/                            # æ„å»ºè„šæœ¬
â”‚   â”œâ”€â”€ build_desktop.py                # æ¡Œé¢åº”ç”¨æ„å»º
â”‚   â”œâ”€â”€ release.py                      # å‘å¸ƒè„šæœ¬
â”‚   â”œâ”€â”€ validate_workflows.py          # å·¥ä½œæµéªŒè¯
â”‚   â””â”€â”€ validate_message_codes.py      # æ¶ˆæ¯ä»£ç éªŒè¯
â”‚
â”œâ”€â”€ docs/                               # æ–‡æ¡£
â”‚   â”œâ”€â”€ architecture/                   # æ¶æ„æ–‡æ¡£
â”‚   â”‚   â”œâ”€â”€ README.md                   # æ¶æ„æ€»è§ˆ
â”‚   â”‚   â”œâ”€â”€ system-overview.md          # ç³»ç»Ÿæ¶æ„
â”‚   â”‚   â”œâ”€â”€ component-details.md        # ç»„ä»¶è¯¦è§£
â”‚   â”‚   â”œâ”€â”€ interaction-flows.md        # äº¤äº’æµç¨‹
â”‚   â”‚   â”œâ”€â”€ api-reference.md            # API å‚è€ƒ
â”‚   â”‚   â””â”€â”€ deployment-guide.md         # éƒ¨ç½²æŒ‡å—
â”‚   â”œâ”€â”€ en/                             # è‹±æ–‡æ–‡æ¡£
â”‚   â”œâ”€â”€ zh-CN/                          # ç®€ä½“ä¸­æ–‡æ–‡æ¡£
â”‚   â””â”€â”€ zh-TW/                          # ç¹ä½“ä¸­æ–‡æ–‡æ¡£
â”‚
â”œâ”€â”€ pyproject.toml                      # Python é¡¹ç›®é…ç½®
â”œâ”€â”€ pytest.ini                          # Pytest é…ç½®
â”œâ”€â”€ Makefile                            # Make æ„å»ºè„šæœ¬
â””â”€â”€ README.md                           # é¡¹ç›®è¯´æ˜
```

### 4.1 å…³é”®æ–‡ä»¶è¯´æ˜

#### `server.py`
- **èŒè´£**: MCP åè®®å®ç°ã€ç¯å¢ƒæ£€æµ‹ã€ä¼šè¯ç®¡ç†
- **ä¸»è¦å·¥å…·**:
  - `interactive_feedback`: äº¤äº’å¼åé¦ˆæ”¶é›†
  - `get_system_info`: ç³»ç»Ÿä¿¡æ¯è·å–
- **æ ¸å¿ƒé€»è¾‘**: å•ä¸€æ´»è·ƒä¼šè¯ç®¡ç†ã€èµ„æºç”Ÿå‘½å‘¨æœŸ

#### `web/main.py`
- **èŒè´£**: FastAPI åº”ç”¨ã€WebSocket æœåŠ¡å™¨ã€è·¯ç”±åˆ†å‘
- **ç«¯ç‚¹**:
  - `GET /`: ä¸»é¡µæ¸²æŸ“
  - `WS /ws/{session_id}`: WebSocket è¿æ¥
  - `POST /upload`: å›¾ç‰‡ä¸Šä¼ 

#### `web/templates/index.html`
- **èŒè´£**: Web UI æ ¸å¿ƒç•Œé¢
- **åŠŸèƒ½æ¨¡å—**:
  - åé¦ˆè¡¨å•
  - å›¾ç‰‡ä¸Šä¼ ä¸é¢„è§ˆ
  - æç¤ºè¯ç®¡ç†ï¼ˆCRUDï¼‰
  - ä¼šè¯å†å²ï¼ˆv2.4.3 é¡µç­¾åŒ–ï¼‰
  - éŸ³æ•ˆé€šçŸ¥ç³»ç»Ÿï¼ˆv2.4.3ï¼‰
  - è‡ªåŠ¨æäº¤å€’è®¡æ—¶

---

## 5. æ ¸å¿ƒæ¨¡å—ç»´æŠ¤æŒ‡å—

### 5.1 ä¼šè¯ç®¡ç†ï¼ˆ`server.py`ï¼‰

#### ä¼šè¯ç”Ÿå‘½å‘¨æœŸ

```python
# åˆ›å»ºä¼šè¯
session = FeedbackSession(
    session_id=session_id,
    project_directory=project_directory,
    summary=summary,
    timeout=timeout
)

# ä¼šè¯çŠ¶æ€
WAITING_USER_INPUT    # ç­‰å¾…ç”¨æˆ·è¾“å…¥
PROCESSING            # å¤„ç†ä¸­
TIMEOUT               # è¶…æ—¶
COMPLETED             # å®Œæˆ
```

#### ç»´æŠ¤è¦ç‚¹

1. **è¶…æ—¶å¤„ç†**: ç¡®ä¿ `timeout` å‚æ•°æ­£ç¡®ä¼ é€’ï¼Œé»˜è®¤ 604800 ç§’ï¼ˆ7 å¤©ï¼‰
2. **ä¼šè¯æ¸…ç†**: è¶…æ—¶æˆ–å®Œæˆåè‡ªåŠ¨æ¸…ç†èµ„æº
3. **æ–­çº¿é‡è¿**: Web UI æ–­å¼€åå¯é‡æ–°è¿æ¥åŒä¸€ä¼šè¯

### 5.2 å›¾ç‰‡å¤„ç†ï¼ˆ`server.py`ï¼‰

#### å½“å‰å®ç°

```python
# æ”¯æŒçš„å›¾ç‰‡æ ¼å¼
SUPPORTED_FORMATS = {
    "image/png",
    "image/jpeg",
    "image/gif",
    "image/webp"
}

# ä¿®å¤åçš„åºåˆ—åŒ–é€»è¾‘
def process_image(image_data):
    # Base64 ç¼–ç 
    # åˆ›å»ºä¸´æ—¶æ–‡ä»¶
    # è¿”å› MCPImage å¯¹è±¡
```

#### ç»´æŠ¤è¦ç‚¹

1. **Base64 ç¼–ç **: ç¡®ä¿æ­£ç¡®ç¼–ç é¿å…åºåˆ—åŒ–é”™è¯¯
2. **ä¸´æ—¶æ–‡ä»¶**: ä½¿ç”¨ `resource_manager.py` ç®¡ç†ä¸´æ—¶æ–‡ä»¶ç”Ÿå‘½å‘¨æœŸ
3. **å†…å­˜ä¼˜åŒ–**: å¤§å›¾ç‰‡è‡ªåŠ¨å‹ç¼©æˆ–æ‹’ç»

### 5.3 WebSocket é€šä¿¡ï¼ˆ`web/main.py`ï¼‰

#### æ¶ˆæ¯æ ¼å¼

```json
{
  "type": "update|feedback|status|error",
  "data": {
    "user_input": "...",
    "images": ["base64_data"],
    "session_id": "..."
  }
}
```

#### ç»´æŠ¤è¦ç‚¹

1. **å¿ƒè·³æ£€æµ‹**: å®šæœŸ ping/pong ä¿æŒè¿æ¥
2. **é”™è¯¯æ¢å¤**: è¿æ¥æ–­å¼€åè‡ªåŠ¨é‡è¿æœºåˆ¶
3. **æ¶ˆæ¯é˜Ÿåˆ—**: é¿å…æ¶ˆæ¯ä¸¢å¤±

### 5.4 å›½é™…åŒ–ç³»ç»Ÿï¼ˆ`i18n.py`ï¼‰

#### è¯­è¨€æ–‡ä»¶ç»“æ„

```
web/locales/
â”œâ”€â”€ en/messages.json          # è‹±æ–‡
â”œâ”€â”€ zh-CN/messages.json       # ç®€ä½“ä¸­æ–‡
â”œâ”€â”€ zh-TW/messages.json       # ç¹ä½“ä¸­æ–‡
```

#### æ·»åŠ æ–°è¯­è¨€æ­¥éª¤

1. åˆ›å»º `web/locales/{lang}/messages.json`
2. ç¿»è¯‘æ‰€æœ‰é”®å€¼å¯¹
3. åœ¨ `i18n.py` ä¸­æ³¨å†Œæ–°è¯­è¨€
4. åœ¨ Web UI æ·»åŠ è¯­è¨€åˆ‡æ¢é€‰é¡¹

---

## 6. æ„å»ºä¸å‘å¸ƒæµç¨‹

### 6.1 ç‰ˆæœ¬å·ç®¡ç†

```bash
# ä½¿ç”¨ bump2version
bump2version patch   # 2.6.0 -> 2.6.1
bump2version minor   # 2.6.0 -> 2.7.0
bump2version major   # 2.6.0 -> 3.0.0
```

### 6.2 æ„å»ºæ­¥éª¤

#### Python åŒ…æ„å»º

```bash
# ä½¿ç”¨ hatchling
python -m build

# æ£€æŸ¥æ„å»ºäº§ç‰©
twine check dist/*
```

#### æ¡Œé¢åº”ç”¨æ„å»º

```bash
# ä½¿ç”¨ Tauri
cd src-tauri
cargo tauri build

# æˆ–ä½¿ç”¨è„šæœ¬
python scripts/build_desktop.py
```

### 6.3 å‘å¸ƒæ£€æŸ¥æ¸…å•

- [ ] æ›´æ–° `pyproject.toml` ç‰ˆæœ¬å·
- [ ] æ›´æ–° `CHANGELOG.md`
- [ ] è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ `pytest`
- [ ] éªŒè¯ Ruff å’Œ Mypy `ruff check . && mypy .`
- [ ] æ„å»º Python åŒ…å’Œæ¡Œé¢åº”ç”¨
- [ ] æµ‹è¯•æœ¬åœ°å®‰è£… `pip install dist/*.whl`
- [ ] æäº¤ Git æ ‡ç­¾ `git tag v2.6.0`
- [ ] æ¨é€åˆ° PyPI `twine upload dist/*`
- [ ] å‘å¸ƒ GitHub Release

---

## 7. æµ‹è¯•ç­–ç•¥

### 7.1 æµ‹è¯•ç»“æ„

```
tests/
â”œâ”€â”€ unit/                  # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ test_server.py     # server.py æµ‹è¯•
â”‚   â”œâ”€â”€ test_i18n.py       # å›½é™…åŒ–æµ‹è¯•
â”‚   â””â”€â”€ ...
â”œâ”€â”€ integration/           # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ test_websocket.py  # WebSocket æµ‹è¯•
â”‚   â””â”€â”€ ...
â””â”€â”€ helpers/               # æµ‹è¯•è¾…åŠ©å·¥å…·
    â””â”€â”€ mcp_client.py      # æ¨¡æ‹Ÿ MCP å®¢æˆ·ç«¯
```

### 7.2 è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/unit/test_server.py

# å¸¦è¦†ç›–ç‡
pytest --cov=src/mcp_feedback_enhanced

# è¶…æ—¶ä¿æŠ¤
pytest --timeout=30
```

### 7.3 æµ‹è¯•ç»´æŠ¤è¦ç‚¹

1. **æ¨¡æ‹Ÿç¯å¢ƒ**: ä½¿ç”¨ `pytest fixtures` æ¨¡æ‹Ÿ MCP ç¯å¢ƒ
2. **å¼‚æ­¥æµ‹è¯•**: ä½¿ç”¨ `pytest-asyncio` æµ‹è¯• WebSocket
3. **æ–­è¨€å‡†ç¡®æ€§**: éªŒè¯ä¼šè¯çŠ¶æ€ã€æ¶ˆæ¯æ ¼å¼ã€é”™è¯¯å¤„ç†

---

## 8. å›½é™…åŒ–ç»´æŠ¤

### 8.1 æ¶ˆæ¯ä»£ç ç³»ç»Ÿï¼ˆ`message_codes.py`ï¼‰

```python
class MessageCode:
    ERROR_INVALID_SESSION = "ERROR_INVALID_SESSION"
    INFO_FEEDBACK_SUBMITTED = "INFO_FEEDBACK_SUBMITTED"
    # ...
```

### 8.2 ç¿»è¯‘æ–‡ä»¶ç¤ºä¾‹

```json
{
  "ERROR_INVALID_SESSION": "æ— æ•ˆçš„ä¼šè¯ ID",
  "INFO_FEEDBACK_SUBMITTED": "åé¦ˆå·²æäº¤",
  "ui.feedback.placeholder": "è¯·è¾“å…¥æ‚¨çš„åé¦ˆ..."
}
```

### 8.3 æ·»åŠ æ–°æ¶ˆæ¯æ­¥éª¤

1. åœ¨ `message_codes.py` å®šä¹‰å¸¸é‡
2. åœ¨æ‰€æœ‰è¯­è¨€æ–‡ä»¶ä¸­æ·»åŠ ç¿»è¯‘
3. è¿è¡ŒéªŒè¯è„šæœ¬: `python scripts/validate_message_codes.py`
4. åœ¨ä»£ç ä¸­ä½¿ç”¨: `i18n.get_message("ERROR_INVALID_SESSION")`

---

## 9. å¸¸è§é—®é¢˜æ’æŸ¥

### 9.1 è¶…æ—¶é—®é¢˜

**ç—‡çŠ¶**: ä¼šè¯æ€»æ˜¯ 600 ç§’åæ–­å¼€

**è¯Šæ–­**:
```python
# æ£€æŸ¥ server.py ä¸­çš„è¶…æ—¶å‚æ•°ä¼ é€’
def interactive_feedback(timeout: int = 604800):
    session = FeedbackSession(..., timeout=timeout)
```

**è§£å†³**: ç¡®ä¿ `timeout` å‚æ•°ä» MCP è°ƒç”¨æ­£ç¡®ä¼ é€’åˆ°ä¼šè¯å¯¹è±¡

### 9.2 å›¾ç‰‡ä¸Šä¼ å¤±è´¥

**ç—‡çŠ¶**: ä¸Šä¼ å›¾ç‰‡æ—¶æŠ¥åºåˆ—åŒ–é”™è¯¯

**è¯Šæ–­**:
```python
# æ£€æŸ¥ Base64 ç¼–ç 
image_data = base64.b64encode(file_content).decode('utf-8')

# æ£€æŸ¥ MIME ç±»å‹
if mime_type not in SUPPORTED_FORMATS:
    raise ValueError(f"Unsupported format: {mime_type}")
```

**è§£å†³**: éªŒè¯ Base64 ç¼–ç å’Œ MIME ç±»å‹æ£€æµ‹é€»è¾‘

### 9.3 WebSocket è¿æ¥æ–­å¼€

**ç—‡çŠ¶**: Web UI é¢‘ç¹æ–­å¼€è¿æ¥

**è¯Šæ–­**:
```bash
# å¯ç”¨è°ƒè¯•æ¨¡å¼
export MCP_DEBUG=true

# æŸ¥çœ‹ WebSocket æ—¥å¿—
tail -f logs/websocket.log
```

**è§£å†³**: 
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
- éªŒè¯å¿ƒè·³æœºåˆ¶
- ç¡®è®¤æµè§ˆå™¨ä¸é˜»æ­¢ WebSocket

### 9.4 æ¡Œé¢åº”ç”¨å¯åŠ¨å¤±è´¥

**ç—‡çŠ¶**: æ¡Œé¢åº”ç”¨æ— æ³•å¯åŠ¨æˆ–ç™½å±

**è¯Šæ–­**:
```bash
# æ£€æŸ¥ Python ç¯å¢ƒ
which python3

# æ£€æŸ¥ Tauri æ—¥å¿—
tauri dev --verbose
```

**è§£å†³**:
- ç¡®ä¿ Python 3.11+ å·²å®‰è£…
- éªŒè¯ Tauri ä¾èµ–å®Œæ•´æ€§
- æ£€æŸ¥ç³»ç»Ÿ WebView ç‰ˆæœ¬

---

## 10. ä¾èµ–ç®¡ç†

### 10.1 æ ¸å¿ƒä¾èµ–

```toml
[project.dependencies]
fastmcp = ">=2.0.0"         # MCP åè®®æ ¸å¿ƒ
psutil = ">=7.0.0"          # ç³»ç»Ÿç›‘æ§
fastapi = ">=0.115.0"       # Web æ¡†æ¶
uvicorn = ">=0.30.0"        # ASGI æœåŠ¡å™¨
jinja2 = ">=3.1.0"          # æ¨¡æ¿å¼•æ“
websockets = ">=13.0.0"     # WebSocket æ”¯æŒ
aiohttp = ">=3.8.0"         # å¼‚æ­¥ HTTP
mcp = ">=1.9.3"             # MCP SDK
```

### 10.2 ä¾èµ–æ›´æ–°ç­–ç•¥

```bash
# æ£€æŸ¥è¿‡æœŸä¾èµ–
pip list --outdated

# æ›´æ–°æ¬¡è¦ç‰ˆæœ¬
pip install -U fastapi

# æµ‹è¯•å…¼å®¹æ€§
pytest
```

### 10.3 é”å®šç‰ˆæœ¬

åœ¨ `pyproject.toml` ä¸­ä½¿ç”¨ `>=` è€Œé `==`ï¼Œå…è®¸è¡¥ä¸ç‰ˆæœ¬æ›´æ–°ä½†éœ€ï¼š
- æ¯æ¬¡æ›´æ–°åè¿è¡Œå®Œæ•´æµ‹è¯•
- åœ¨ `CHANGELOG.md` è®°å½•ä¾èµ–å˜æ›´

---

## 11. æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 11.1 å†…å­˜ä¼˜åŒ–

```python
# ä½¿ç”¨ memory_monitor.py ç›‘æ§
from .utils.memory_monitor import MemoryMonitor

monitor = MemoryMonitor()
monitor.start_monitoring()

# å®šæœŸæ¸…ç†ä¸´æ—¶æ–‡ä»¶
resource_manager.cleanup_old_files()
```

### 11.2 WebSocket ä¼˜åŒ–

- **æ¶ˆæ¯æ‰¹å¤„ç†**: åˆå¹¶é¢‘ç¹çš„å°æ¶ˆæ¯
- **å‹ç¼©**: å¯ç”¨ `permessage-deflate` å‹ç¼©
- **è¿æ¥æ± **: å¤ç”¨ WebSocket è¿æ¥

### 11.3 æ•°æ®åº“ä¼˜åŒ–ï¼ˆæœªæ¥è€ƒè™‘ï¼‰

å½“å‰ä½¿ç”¨å†…å­˜å­˜å‚¨ï¼Œå¤§è§„æ¨¡éƒ¨ç½²å¯è€ƒè™‘ï¼š
- SQLite: æœ¬åœ°æŒä¹…åŒ–
- Redis: ä¼šè¯ç¼“å­˜
- PostgreSQL: ç”Ÿäº§ç¯å¢ƒ

---

## 12. å®‰å…¨æ³¨æ„äº‹é¡¹

### 12.1 è¾“å…¥éªŒè¯

```python
# ä¸¥æ ¼éªŒè¯ç”¨æˆ·è¾“å…¥
def validate_session_id(session_id: str):
    if not re.match(r'^[a-zA-Z0-9_-]{8,64}$', session_id):
        raise ValueError("Invalid session ID format")
```

### 12.2 æ–‡ä»¶ä¸Šä¼ å®‰å…¨

```python
# é™åˆ¶æ–‡ä»¶å¤§å°
MAX_FILE_SIZE = 10 * 1024 * 1024  # 10MB

# éªŒè¯ MIME ç±»å‹
if not magic.from_buffer(file_content, mime=True) in ALLOWED_TYPES:
    raise ValueError("Invalid file type")
```

### 12.3 XSS é˜²æŠ¤

- ä½¿ç”¨ Jinja2 è‡ªåŠ¨è½¬ä¹‰
- é¿å…ç›´æ¥æ’å…¥ HTML
- éªŒè¯ CSPï¼ˆContent Security Policyï¼‰

### 12.4 CSRF é˜²æŠ¤

```python
# ä¸ºè¡¨å•æ·»åŠ  CSRF Token
from fastapi_csrf import CsrfProtect

@app.post("/upload")
async def upload(csrf_token: str = Form(...)):
    # éªŒè¯ CSRF token
```

---

## 13. è´¡çŒ®æŒ‡å—

### 13.1 ä»£ç é£æ ¼

```bash
# ä½¿ç”¨ Ruff æ ¼å¼åŒ–
ruff check --fix .

# ç±»å‹æ£€æŸ¥
mypy src/

# Pre-commit hooks
pre-commit install
pre-commit run --all-files
```

### 13.2 æäº¤è§„èŒƒ

```
<type>(<scope>): <subject>

<body>

<footer>
```

**ç±»å‹**:
- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤ Bug
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼
- `refactor`: é‡æ„
- `test`: æµ‹è¯•
- `chore`: æ„å»º/å·¥å…·

**ç¤ºä¾‹**:
```
feat(websocket): æ·»åŠ æ–­çº¿é‡è¿æœºåˆ¶

- å®ç°æŒ‡æ•°é€€é¿é‡è¿ç­–ç•¥
- æ·»åŠ æœ€å¤§é‡è¿æ¬¡æ•°é™åˆ¶
- æ›´æ–°ç›¸å…³æµ‹è¯•

Closes #123
```

### 13.3 Pull Request æµç¨‹

1. Fork é¡¹ç›®åˆ°ä¸ªäººä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ `git checkout -b feature/my-feature`
3. æäº¤ä»£ç å¹¶æ¨é€ `git push origin feature/my-feature`
4. åœ¨ GitHub åˆ›å»º Pull Request
5. ç­‰å¾… Code Review å¹¶æ ¹æ®åé¦ˆä¿®æ”¹
6. åˆå¹¶åˆ°ä¸»åˆ†æ”¯

---

## é™„å½•

### A. æœ‰ç”¨çš„å‘½ä»¤

```bash
# æŸ¥çœ‹é¡¹ç›®ä¾èµ–æ ‘
pip-tree

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
python scripts/cleanup_cache.py

# éªŒè¯å·¥ä½œæµé…ç½®
python scripts/validate_workflows.py

# ç”Ÿæˆ Tauri å›¾æ ‡
cd src-tauri && python generate_icons.py
```

### B. ç›¸å…³èµ„æº

- [MCP å®˜æ–¹æ–‡æ¡£](https://modelcontextprotocol.io/)
- [FastAPI æ–‡æ¡£](https://fastapi.tiangolo.com/)
- [Tauri æ–‡æ¡£](https://tauri.app/)
- [WebSocket API](https://developer.mozilla.org/en-US/docs/Web/API/WebSocket)

### C. ç»´æŠ¤è€…è”ç³»æ–¹å¼

- **åŸä½œè€…**: Minidoracat
- **GitHub**: [Minidoracat/mcp-feedback-enhanced](https://github.com/Minidoracat/mcp-feedback-enhanced)
- **æœ¬åœ°å®šåˆ¶ç‰ˆ**: [ä½ çš„ GitHub ä»“åº“]

---

**æ–‡æ¡£ç»“æŸ** - å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issue æˆ– Pull Requestã€‚
